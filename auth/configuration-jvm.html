<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>24.8. JVM Settings -  - The Neo4j Manual v2.2-SNAPSHOT</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="configuration-logical-logs.html" title="24.7. Logical logs" /><link rel="next" href="short-strings.html" title="24.9. Compressed storage of short strings" /><link rel="copyright" href="ln-d5e39.html" title="License: Creative Commons 3.0" /><meta name="Section-title" content="24.8. JVM Settings" /><script type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-71248";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><meta name="viewport" content="width=device-width, initial-scale=1" /><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/redmond/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><link rel="stylesheet" type="text/css" href="common/css/positioning.css" /><link rel="stylesheet" type="text/css" href="common/css/style.css" /><!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
  <![endif]--><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><script type="text/javascript" src="common/browserDetect.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script><script type="text/javascript" src="common/jquery/jquery.highlight.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/1.4.11/jquery.scrollTo.min.js"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><script type="text/javascript" src="common/main.js"></script><script type="text/javascript" src="search/l10n.js"></script><script type="text/javascript" src="search/htmlFileInfoList.js"></script><script type="text/javascript" src="common/search.js"></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"></script><script type="text/javascript" src="search/index-1.js"></script><script type="text/javascript" src="search/index-2.js"></script><script type="text/javascript" src="search/index-3.js"></script>


<!-- favicon -->

<link rel="shortcut icon" href="common/images/favicon.ico" />

<!-- fonts -->

<link href='//fonts.googleapis.com/css?family=Ubuntu+Mono|PT+Sans:400,700,400italic' rel='stylesheet' type='text/css' />

<!-- Syntax Highlighter -->

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/codemirror.min.css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/theme/neo.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/codemirror.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/addon/runmode/runmode.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/javascript/javascript.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/shell/shell.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/sql/sql.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/xml/xml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/clike/clike.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/cypher/cypher.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/properties/properties.min.js"></script>

<script src="js/colorize.js"></script>
 
<script type="text/javascript">
  $(function (){
    CodeMirror.colorize();
  });
</script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/console.js"></script>
<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->
<script type="text/javascript" src="js/version.js"></script>
<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- Discuss -->
<script type="text/javascript" src="js/mutate.min.js"></script>
<script type="text/javascript" src="js/disqus.js"></script>

<script type="text/javascript">
    /*@cc_on @*/
    /*@
     $( '#content' ).addClass( 'internet-explorer' );
     @*/
</script>


</head><body><div id="header"><a href="index.html" id="logo"><img src="common/images/logo-neo4j.svg" alt="" /></a><h1><span id="book-title">The Neo4j Manual v2.2-SNAPSHOT</span><span>24.8. JVM Settings</span></h1><div id="navheader"><!----><div id="navLinks"><span><a id="showHideButton" href="#" class="pointLeft" tabindex="5" title="Show/Hide TOC tree"><i class="fa fa-columns"></i> Contents
            </a></span><span><a accesskey="p" id="navLinkPrevious" tabindex="5" href="configuration-logical-logs.html"><i class="fa fa-arrow-circle-left"></i> Prev</a></span><span><a accesskey="u" id="navLinkUp" tabindex="5" href="configuration.html">Up <i class="fa fa-arrow-circle-up"></i></a></span><span><a accesskey="n" id="navLinkNext" tabindex="5" href="short-strings.html">Next <i class="fa fa-arrow-circle-right"></i></a></span></div></div></div><div id="content"><section class="section" id="configuration-jvm"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">24.8. JVM Settings</h2></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="configuration-jvm.html#_background">Background</a></span></li><li><span class="section"><a href="configuration-jvm.html#_configuring_heap_size_and_gc">Configuring heap size and GC</a></span></li></ul></div>

<section class="section" id="_background"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Background</h3></div></div></div>

<p>There are two main memory parameters for the JVM, one controls the heap space and the other controls the stack space. The heap space parameter is the most important one for Neo4j, since this governs how many objects you can allocate. The stack space parameter governs the how deep the call stack of your application is allowed to get.</p>
<p>When it comes to heap space the general rule is: the larger heap space you have the better, but make sure the heap fits in the RAM memory of the computer. If the heap is paged out to disk performance will degrade rapidly. Having a heap that is much larger than what your application needs is not good either, since this means that the JVM will accumulate a lot of dead objects before the garbage collector is executed, this leads to long garbage collection pauses and undesired performance behavior.</p>
<p>Having a larger heap space will mean that Neo4j can handle larger transactions and more concurrent transactions. A large heap space will also make Neo4j run faster since it means Neo4j can fit a larger portion of the graph in its caches, meaning that the nodes and relationships your application uses frequently are always available quickly. The default heap size for a 32bit JVM is 64MB (and 30% larger for 64bit), which is too small for most real applications.</p>
<p>Neo4j works fine with the default stack space configuration, but if your application implements some recursive behavior it is a good idea to increment the stack size. Note that the stack size is shared for all threads, so if you application is running a lot of concurrent threads it is a good idea to increase the stack size.</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">

The heap size is set by specifying the <code class="literal">-Xmx???m</code> parameter to hotspot, where <code class="literal">???</code> is the heap size in megabytes. Default heap size is 64MB for 32bit JVMs, 30% larger (appr. 83MB) for 64bit JVMs.

</li><li class="listitem">

The stack size is set by specifying the <code class="literal">-Xss???m</code> parameter to hotspot, where <code class="literal">???</code> is the stack size in megabytes. Default stack size is 512kB for 32bit JVMs on Solaris, 320kB for 32bit JVMs on Linux (and Windows), and 1024kB for 64bit JVMs.

</li></ul></div>
<p>Most modern CPUs implement a <a class="ulink" href="http://en.wikipedia.org/wiki/Non-Uniform_Memory_Access" target="_blank">Non-Uniform Memory Access (NUMA) architecture</a>, where different parts of the memory have different access speeds. Suns Hotspot JVM is able to allocate objects with awareness of the NUMA structure as of version 1.6.0 update 18. When enabled this can give up to 40% performance improvements. To enabled the NUMA awareness, specify the <code class="literal">-XX:+UseNUMA</code> parameter (works only when using the Parallel Scavenger garbage collector (default or <code class="literal">-XX:+UseParallelGC</code> not the concurrent mark and sweep one).</p>
<p>Properly configuring memory utilization of the JVM is crucial for optimal performance.
As an example, a poorly configured JVM could spend all CPU time performing garbage collection (blocking all threads from performing any work).
Requirements such as latency, total throughput and available hardware have to be considered to find the right setup.
In production, Neo4j should run on a multi core/CPU platform with the JVM in server mode.</p>
</section>
<section class="section" id="_configuring_heap_size_and_gc"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Configuring heap size and GC</h3></div></div></div>

<div class="admonitionblock Note"><table><tr><td class="icon"><img alt="[Note]" src="images/icons/admon/note.svg" /></td><td class="content"><b>Note</b><p>When using Neo4j Server, JVM configuration goes into the <code class="literal">conf/neo4j-wrapper.conf</code> file, see <a class="xref" href="server-configuration.html" title="24.2. Server Configuration">Section 24.2, “Server Configuration”</a>.</p></td></tr></table></div>
<p>A large heap allows for larger node and relationship caches — which is a good thing — but large heaps can also lead to latency problems caused by full garbage collection.
The different high level cache implementations available in Neo4j together with a suitable JVM configuration of heap size and garbage collection (GC) should be able to handle most workloads.</p>
<p>The default cache (soft reference based LRU cache) works best with a heap that never gets full: a graph where the most used nodes and relationships can be cached.
If the heap gets too full there is a risk that a full GC will be triggered; the larger the heap, the longer it can take to determine what soft references should be cleared.</p>
<p>Using the strong reference cache means that <span class="emphasis"><em>all</em></span> the nodes and relationships being used must fit in the available heap.
Otherwise there is a risk of getting out-of-memory exceptions.
The soft reference and strong reference caches are well suited for applications were the overal throughput is important.</p>
<p>The weak reference cache basically needs enough heap to handle the peak load of the application — peak load multiplied by the average memory required per request.
It is well suited for low latency requirements were GC interuptions are not acceptable.</p>
<div class="table" id="d5e22937"><p class="title"><strong>Guidelines for heap size</strong></p><div class="table-contents">




<table cellspacing="0" cellpadding="0"><thead><tr><th>Number of entities</th><th>RAM size</th><th>Heap configuration</th><th>Reserved RAM for the OS</th></tr></thead><tbody><tr><td><p>10M</p></td><td><p>2GB</p></td><td><p>512MB</p></td><td><p>~1GB</p></td></tr><tr><td><p>100M</p></td><td><p>8GB+</p></td><td><p>1-4GB</p></td><td><p>1-2GB</p></td></tr><tr><td><p>1B+</p></td><td><p>16GB-32GB+</p></td><td><p>4GB+</p></td><td><p>1-2GB</p></td></tr></tbody></table>
</div></div>
<div class="admonitionblock Tip"><table><tr><td class="icon"><img alt="[Tip]" src="images/icons/admon/tip.svg" /></td><td class="content"><b>Tip</b><p>The recommended garbage collector to use when running Neo4j in production is the Concurrent Mark and Sweep Compactor turned on by supplying <code class="literal">-XX:+UseConcMarkSweepGC</code> as a JVM parameter.</p></td></tr></table></div>
<p>When having made sure that the heap size is well configured the second thing to tune in order to tune the garbage collector for your application is to specify the sizes of the different generations of the heap. The default settings are well tuned for "normal" applications, and work quite well for most applications, but if you have an application with either really high allocation rate, or a lot of long lived objects you might want to consider tuning the sizes of the heap generation. The ratio between the young and tenured generation of the heap is specified by using the <code class="literal">-XX:NewRatio=#</code> command line option (where <code class="literal">#</code> is replaced by a number). The default ratio is 1:12 for client mode JVM, and 1:8 for server mode JVM. You can also specify the size of the young generation explicitly using the <code class="literal">-Xmn</code> command line option, which works just like the <code class="literal">-Xmx</code> option that specifies the total heap space.</p>
<div class="informaltable">
<table cellspacing="0" cellpadding="0"><thead><tr><th>GC shortname </th><th>Generation </th><th> Command line parameter </th><th>Comment</th></tr></thead><tbody><tr><td><p>Copy</p></td><td><p>Young</p></td><td><p><code class="literal">-XX:+UseSerialGC</code></p></td><td><p>The Copying collector</p></td></tr><tr><td><p>MarkSweepCompact</p></td><td><p>Tenured</p></td><td><p><code class="literal">-XX:+UseSerialGC</code></p></td><td><p>The Mark and Sweep Compactor</p></td></tr><tr><td><p>ConcurrentMarkSweep</p></td><td><p>Tenured</p></td><td><p><code class="literal">-XX:+UseConcMarkSweepGC</code></p></td><td><p>The Concurrent Mark and Sweep Compactor</p></td></tr><tr><td><p>ParNew</p></td><td><p>Young</p></td><td><p><code class="literal">-XX:+UseParNewGC</code></p></td><td><p>The parallel Young Generation Collector — can only be used with the Concurrent mark and sweep compactor.</p></td></tr><tr><td><p>PS Scavenge</p></td><td><p>Young</p></td><td><p><code class="literal">-XX:+UseParallelGC</code></p></td><td><p>The parallel object scavenger</p></td></tr><tr><td><p>PS MarkSweep</p></td><td><p>Tenured</p></td><td><p><code class="literal">-XX:+UseParallelGC</code></p></td><td><p>The parallel mark and sweep collector</p></td></tr></tbody></table>
</div>
<p>These are the default configurations on some platforms according to our non-exhaustive research:</p>
<div class="informaltable">
<table cellspacing="0" cellpadding="0"><thead><tr><th>JVM </th><th>-d32 -client </th><th>-d32 -server </th><th>-d64 -client </th><th>-d64 -server</th></tr></thead><tbody><tr><td><p>Mac OS X Snow Leopard, 64-bit, Hotspot 1.6.0_17</p></td><td><p><code class="literal">ParNew</code> and <code class="literal">ConcurrentMarkSweep</code></p></td><td><p><code class="literal">PS Scavenge</code> and <code class="literal">PS MarkSweep</code></p></td><td><p><code class="literal">ParNew</code> and <code class="literal">ConcurrentMarkSweep</code></p></td><td><p><code class="literal">PS Scavenge</code> and <code class="literal">PS MarkSweep</code></p></td></tr><tr><td><p>Ubuntu, 32-bit, Hotspot 1.6.0_16</p></td><td><p><code class="literal">Copy</code> and <code class="literal">MarkSweepCompact</code></p></td><td><p><code class="literal">Copy</code> and <code class="literal">MarkSweepCompact</code></p></td><td><p>N/A</p></td><td><p>N/A</p></td></tr></tbody></table>
</div>
</section>
</section>

 <footer>
   <p>
   © Copyright
   <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img id="copyright-img" src="images/by-sa.svg" alt="CC BY-SA 3.0" title="Creative Commons Attribution-ShareAlike 3.0"></a>
   <a href="http://neo4j.com/"><img id="neotech-logo" src="images/neo-technology.svg" alt="Neo Technology"></a>
   </p>
 </footer>
  <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    //Allow Linker
    ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
    ga('send', 'pageview');

    // Load the plugin.
    ga('require', 'linker');

    // Define which domains to autoLink.
    ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
  </script>

</div></body></html>