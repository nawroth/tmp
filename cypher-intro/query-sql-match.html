<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>16.2. Matching connected nodes -  - The Neo4j Manual v2.2-SNAPSHOT</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="query-sql-start.html" title="16.1. Finding basic patterns" /><link rel="next" href="query-sql-where.html" title="16.3. Where" /><link rel="copyright" href="ln-d5e41.html" title="License: Creative Commons 3.0" /><meta name="Section-title" content="16.2. Matching connected nodes" /><script type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-66629";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><meta name="viewport" content="width=device-width, initial-scale=1" /><link href="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/themes/redmond/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><link rel="stylesheet" type="text/css" href="common/css/positioning.css" /><link rel="stylesheet" type="text/css" href="common/css/style.css" /><!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
  <![endif]--><link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet" /><script type="text/javascript" src="common/browserDetect.js"></script><script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script><script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script><script type="text/javascript" src="common/jquery/jquery.highlight.js"></script><script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.0/jquery.cookie.min.js"></script><script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script><script type="text/javascript" src="http://cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/1.4.11/jquery.scrollTo.min.js"></script><script src="http://netdna.bootstrapcdn.com/bootstrap/3.1.1/js/bootstrap.min.js"></script><script type="text/javascript" src="common/main.js"></script><script type="text/javascript" src="search/l10n.js"></script><script type="text/javascript" src="search/htmlFileInfoList.js"></script><script type="text/javascript" src="common/search.js"></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"></script><script type="text/javascript" src="search/index-1.js"></script><script type="text/javascript" src="search/index-2.js"></script><script type="text/javascript" src="search/index-3.js"></script>


<!-- favicon -->

<link rel="shortcut icon" href="common/images/favicon.ico" />

<!-- fonts -->

<link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono|PT+Sans:400,700,400italic' rel='stylesheet' type='text/css' />

<!-- Syntax Highlighter -->

<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/codemirror.css" />
<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/theme/neo.css" />
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/codemirror.min.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/addon/runmode/runmode.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/javascript/javascript.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/shell/shell.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/sql/sql.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/xml/xml.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/clike/clike.js"></script>
<script src="http://cdnjs.cloudflare.com/ajax/libs/codemirror/4.3.0/mode/cypher/cypher.js"></script>

<script src="js/colorize.js"></script>
 
<script type="text/javascript">
  $(function (){
    CodeMirror.colorize();
  });
</script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/console.js"></script>
<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->
<script type="text/javascript" src="js/version.js"></script>
<script type="text/javascript" src="http://docs.neo4j.org/chunked/versions.js"></script>
<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- Discuss -->
<script type="text/javascript" src="js/mutate.min.js"></script>
<script type="text/javascript" src="js/disqus.js"></script>

<script type="text/javascript">
    /*@cc_on @*/
    /*@
     $( '#content' ).addClass( 'internet-explorer' );
     @*/
</script>


</head><body><div id="header"><a href="index.html" id="logo"><img src="common/images/logo-neo4j.svg" alt="" /></a><h1><span id="book-title">The Neo4j Manual v2.2-SNAPSHOT</span><span>16.2. Matching connected nodes</span></h1><div id="navheader"><!----><div id="navLinks"><span><a id="showHideButton" href="#" class="pointLeft" tabindex="5" title="Show/Hide TOC tree"><i class="fa fa-columns"></i> Contents
            </a></span><span><a accesskey="p" id="navLinkPrevious" tabindex="5" href="query-sql-start.html"><i class="fa fa-arrow-circle-left"></i> Prev</a></span><span><a accesskey="u" id="navLinkUp" tabindex="5" href="examples-from-sql-to-cypher.html">Up <i class="fa fa-arrow-circle-up"></i></a></span><span><a accesskey="n" id="navLinkNext" tabindex="5" href="query-sql-where.html">Next <i class="fa fa-arrow-circle-right"></i></a></span></div></div></div><div id="content"><section class="section" id="query-sql-match"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">16.2. Matching connected nodes</h2></div></div></div>

<p>Unlike SQL which operates on sets, Cypher predominantly works on sub-graphs.
The relational equivalent is the current set of tuples being evaluated during a <code class="literal">SELECT</code> query.</p>
<p>The shape of the sub-graph is specified in the <code class="literal">MATCH</code> clause.
The <code class="literal">MATCH</code> clause is analogous to the <code class="literal">JOIN</code> in SQL. A normal a→b relationship is an
inner join between nodes a and b — both sides have to have at least one match, or nothing is returned.</p>
<p>We’ll start with a simple example, where we find all email addresses that are connected to
the person “Anakin”. This is an ordinary one-to-many relationship.</p>
<p><strong>SQL Query. </strong>
</p><pre class="programlisting" data-lang="sql">SELECT "Email".* FROM "Person" JOIN "Email" ON "Person".id = "Email".person_id WHERE "Person".name = 'Anakin'</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>ADDRESS</th><th>COMMENT</th><th>PERSON_ID</th></tr></thead><tfoot><tr><th colspan="3">2 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">anakin@example.com</code></p></td><td><p><code class="literal">home</code></p></td><td><p><code class="literal">1</code></p></td></tr><tr><td><p><code class="literal">anakin@example.org</code></p></td><td><p><code class="literal">work</code></p></td><td><p><code class="literal">1</code></p></td></tr></tbody></table></div>
<p><strong>Cypher Query. </strong>
</p><pre class="programlisting" data-lang="cypher">MATCH (person:Person { name: 'Anakin' })-[:email]-&gt;(email)
RETURN email</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>email</th></tr></thead><tfoot><tr><th>2 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">Node[7]{address:"anakin@example.org",comment:"work"}</code></p></td></tr><tr><td><p><code class="literal">Node[6]{address:"anakin@example.com",comment:"home"}</code></p></td></tr></tbody></table></div>
<p>There is no join table here, but if one is necessary the next example will show how to do that, writing the pattern relationship like so:
<code class="literal">-[r:belongs_to]-&gt;</code> will introduce (the equivalent of) join table available as the variable <code class="literal">r</code>.
In reality this is a named relationship in Cypher, so we’re saying “join <code class="literal">Person</code> to <code class="literal">Group</code> via <code class="literal">belongs_to</code>.”
To illustrate this, consider this image, comparing the SQL model and Neo4j/Cypher.</p>
<div class="informalfigure">
<a class="ulink" href="images/RDBMSvsGraph.svg.png" target="_blank">
<span class="inlinemediaobject"><img src="images/RDBMSvsGraph.svg.png" alt="RDBMSvsGraph.svg.png" /></span>
</a>
</div>
<p>And here are example queries:</p>
<p><strong>SQL Query. </strong>
</p><pre class="programlisting" data-lang="sql">SELECT "Group".*, "Person_Group".* FROM "Person" JOIN "Person_Group" ON "Person".id = "Person_Group".person_id JOIN "Group" ON "Person_Group".Group_id="Group".id WHERE "Person".name = 'Bridget'</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>NAME</th><th>ID</th><th>BELONGS_TO_GROUP_ID</th><th>PERSON_ID</th><th>GROUP_ID</th></tr></thead><tfoot><tr><th colspan="5">1 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">Admin</code></p></td><td><p><code class="literal">4</code></p></td><td><p><code class="literal">3</code></p></td><td><p><code class="literal">2</code></p></td><td><p><code class="literal">4</code></p></td></tr></tbody></table></div>
<p><strong>Cypher Query. </strong>
</p><pre class="programlisting" data-lang="cypher">MATCH (person:Person { name: 'Bridget' })-[r:belongs_to]-&gt;(group)
RETURN group, r</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>group</th><th>r</th></tr></thead><tfoot><tr><th colspan="2">1 row</th></tr></tfoot><tbody><tr><td><p><code class="literal">Node[5]{name:"Admin",id:4}</code></p></td><td><p><code class="literal">:belongs_to[0]{}</code></p></td></tr></tbody></table></div>
<p>An <a class="ulink" href="http://www.codinghorror.com/blog/2007/10/a-visual-explanation-of-sql-joins.html" target="_blank">outer join</a> is just as easy.
Add <code class="literal">OPTIONAL</code> before the match and it’s an optional relationship between nodes — the outer join of Cypher.</p>
<p>Whether it’s a left outer join, or a right outer join is defined by which side of the pattern has a starting point.
This example is a left outer join, because the bound node is on the left side:</p>
<p><strong>SQL Query. </strong>
</p><pre class="programlisting" data-lang="sql">SELECT "Person".name, "Email".address FROM "Person" LEFT JOIN "Email" ON "Person".id = "Email".person_id</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>NAME</th><th>ADDRESS</th></tr></thead><tfoot><tr><th colspan="2">3 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">Anakin</code></p></td><td><p><code class="literal">anakin@example.com</code></p></td></tr><tr><td><p><code class="literal">Anakin</code></p></td><td><p><code class="literal">anakin@example.org</code></p></td></tr><tr><td><p><code class="literal">Bridget</code></p></td><td><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div>
<p><strong>Cypher Query. </strong>
</p><pre class="programlisting" data-lang="cypher">MATCH (person:Person)
WHERE HAS (person.name)
OPTIONAL MATCH (person)-[:email]-&gt;(email)
RETURN person.name, email.address</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>person.name</th><th>email.address</th></tr></thead><tfoot><tr><th colspan="2">3 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"Anakin"</code></p></td><td><p><code class="literal">"anakin@example.org"</code></p></td></tr><tr><td><p><code class="literal">"Anakin"</code></p></td><td><p><code class="literal">"anakin@example.com"</code></p></td></tr><tr><td><p><code class="literal">"Bridget"</code></p></td><td><p><code class="literal">&lt;null&gt;</code></p></td></tr></tbody></table></div>
<p>Relationships in Neo4j are first class citizens — it’s like the SQL tables are pre-joined with each other.
So, naturally, Cypher is designed to be able to handle highly connected data easily.</p>
<p>One such domain is tree structures — anyone that has tried storing tree structures in SQL knows
that you have to work hard to get around the limitations of the relational model.
There are even books on the subject.</p>
<p>To find all the groups and sub-groups that Bridget belongs to, this query is enough in Cypher:</p>
<p><strong>Cypher Query. </strong>
</p><pre class="programlisting" data-lang="cypher">MATCH (person:Person { name: 'Bridget' })-[:belongs_to*]-&gt;(group)
RETURN person.name, group.name</pre><p>
</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>person.name</th><th>group.name</th></tr></thead><tfoot><tr><th colspan="2">3 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"Bridget"</code></p></td><td><p><code class="literal">"Admin"</code></p></td></tr><tr><td><p><code class="literal">"Bridget"</code></p></td><td><p><code class="literal">"Technichian"</code></p></td></tr><tr><td><p><code class="literal">"Bridget"</code></p></td><td><p><code class="literal">"User"</code></p></td></tr></tbody></table></div>
<p>The <code class="literal">*</code> after the relationship type means that there can be multiple hops across <code class="literal">belongs_to</code> relationships between group and user.
Some SQL dialects have recursive abilities, that allow the expression of queries like this, but you may have a hard time wrapping your head around those.
Expressing something like this in SQL is hugely impractical if not practically impossible.</p>
</section>

 <footer>
   <p>
   © Copyright
   <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img id="copyright-img" src="images/by-sa.svg" alt="CC BY-SA 3.0" title="Creative Commons Attribution-ShareAlike 3.0"></a>
   <a href="http://www.neotechnology.com/"><img id="neotech-logo" src="images/neo-technology.svg" alt="Neo Technology"></a>
   </p>
 </footer>
  <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    //Allow Linker
    ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
    ga('send', 'pageview');

    // Load the plugin.
    ga('require', 'linker');

    // Define which domains to autoLink.
    ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
  </script>

</div></body></html>