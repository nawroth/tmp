<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>7.16. User roles in graphs -  - The Neo4j Manual v2.2-SNAPSHOT</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="cypher-cookbook-graphity.html" title="7.15. The Graphity activity stream model" /><link rel="next" href="languages.html" title="Chapter 8. Languages" /><link rel="copyright" href="ln-d5e39.html" title="License: Creative Commons 3.0" /><meta name="Section-title" content="7.16. User roles in graphs" /><script type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-76013";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><meta name="viewport" content="width=device-width, initial-scale=1" /><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/redmond/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><link rel="stylesheet" type="text/css" href="common/css/positioning.css" /><link rel="stylesheet" type="text/css" href="common/css/style.css" /><!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
  <![endif]--><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><script type="text/javascript" src="common/browserDetect.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script><script type="text/javascript" src="common/jquery/jquery.highlight.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/1.4.11/jquery.scrollTo.min.js"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><script type="text/javascript" src="common/main.js"></script><script type="text/javascript" src="search/l10n.js"></script><script type="text/javascript" src="search/htmlFileInfoList.js"></script><script type="text/javascript" src="common/search.js"></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"></script><script type="text/javascript" src="search/index-1.js"></script><script type="text/javascript" src="search/index-2.js"></script><script type="text/javascript" src="search/index-3.js"></script>


<!-- favicon -->

<link rel="shortcut icon" href="common/images/favicon.ico" />

<!-- fonts -->

<link href='//fonts.googleapis.com/css?family=Ubuntu+Mono|PT+Sans:400,700,400italic' rel='stylesheet' type='text/css' />

<!-- Syntax Highlighter -->

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/codemirror.min.css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/theme/neo.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/codemirror.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/addon/runmode/runmode.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/javascript/javascript.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/shell/shell.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/sql/sql.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/xml/xml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/clike/clike.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/cypher/cypher.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.10.0/mode/properties/properties.min.js"></script>

<script src="js/colorize.js"></script>
 
<script type="text/javascript">
  $(function (){
    CodeMirror.colorize();
  });
</script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/console.js"></script>
<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->
<script type="text/javascript" src="js/version.js"></script>
<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- Discuss -->
<script type="text/javascript" src="js/mutate.min.js"></script>
<script type="text/javascript" src="js/disqus.js"></script>

<script type="text/javascript">
    /*@cc_on @*/
    /*@
     $( '#content' ).addClass( 'internet-explorer' );
     @*/
</script>


</head><body><div id="header"><a href="index.html" id="logo"><img src="common/images/logo-neo4j.svg" alt="" /></a><h1><span id="book-title">The Neo4j Manual v2.2-SNAPSHOT</span><span>7.16. User roles in graphs</span></h1><div id="navheader"><!----><div id="navLinks"><span><a id="showHideButton" href="#" class="pointLeft" tabindex="5" title="Show/Hide TOC tree"><i class="fa fa-columns"></i> Contents
            </a></span><span><a accesskey="p" id="navLinkPrevious" tabindex="5" href="cypher-cookbook-graphity.html"><i class="fa fa-arrow-circle-left"></i> Prev</a></span><span><a accesskey="u" id="navLinkUp" tabindex="5" href="data-modeling-examples-advanced.html">Up <i class="fa fa-arrow-circle-up"></i></a></span><span><a accesskey="n" id="navLinkNext" tabindex="5" href="languages.html">Next <i class="fa fa-arrow-circle-right"></i></a></span></div></div></div><div id="content"><section class="section" id="examples-user-roles-in-graphs"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">7.16. User roles in graphs</h2></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="examples-user-roles-in-graphs.html#_get_the_admins">Get the admins</a></span></li><li><span class="section"><a href="examples-user-roles-in-graphs.html#_get_the_group_memberships_of_a_user">Get the group memberships of a user</a></span></li><li><span class="section"><a href="examples-user-roles-in-graphs.html#_get_all_groups">Get all groups</a></span></li><li><span class="section"><a href="examples-user-roles-in-graphs.html#_get_all_members_of_all_groups">Get all members of all groups</a></span></li></ul></div>

<p>This is an example showing a hierarchy of
roles.
What’s interesting is that a tree is not sufficient for storing this kind of structure,
as elaborated below.</p>
<div class="informalfigure">
<a class="ulink" href="images/roles.png" target="_blank">
<span class="inlinemediaobject"><img src="images/roles.png" alt="roles.png" /></span>
</a>
</div>
<p>This is an implementation of an example found in the article
<a class="ulink" href="http://www.codeproject.com/Articles/22824/A-Model-to-Represent-Directed-Acyclic-Graphs-DAG-o" target="_blank">A Model to Represent Directed Acyclic Graphs (DAG) on SQL Databases</a>
by <a class="ulink" href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=274518" target="_blank">Kemal Erdogan</a>.
The article discusses how to store <a class="ulink" href="http://en.wikipedia.org/wiki/Directed_acyclic_graph" target="_blank">
directed acyclic graphs</a> (DAGs)
in SQL based DBs. DAGs are almost trees, but with a twist: it may be possible to reach
the same node through different paths. Trees are restricted from this possibility, which
makes them much easier to handle. In our case it is “Ali” and “Engin”,
as they are both admins and users and thus reachable through these group nodes.
Reality often looks this way and can’t be captured by tree structures.</p>
<p>In the article an SQL Stored Procedure solution is provided. The main idea,
that also have some support from scientists, is to pre-calculate all possible (transitive) paths.
Pros and cons of this approach:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">

decent performance on read

</li><li class="listitem">

low performance on insert

</li><li class="listitem">

wastes <span class="emphasis"><em>lots</em></span> of space

</li><li class="listitem">

relies on stored procedures

</li></ul></div>
<p>In Neo4j storing the roles is trivial. In this case we use <code class="literal">PART_OF</code> (green edges) relationships
to model the group hierarchy and <code class="literal">MEMBER_OF</code> (blue edges) to model membership in groups.
We also connect the top level groups to the reference node by <code class="literal">ROOT</code> relationships.
This gives us a useful partitioning of the graph. Neo4j has no predefined relationship
types, you are free to create any relationship types and give them the semantics you want.</p>
<p>Lets now have a look at how to retrieve information from the graph. The the queries are done using <a class="link" href="cypher-query-lang.html" title="Cypher Query Language">Cypher</a>,
the Java code is using the Neo4j Traversal API (see <a class="xref" href="tutorial-traversal-java-api.html" title="37.2. Traversal Framework Java API">Section 37.2, “Traversal Framework Java API”</a>, which is part of <a class="xref" href="advanced-usage.html" title="Advanced Usage">Advanced Usage</a>).</p>
<section class="section" id="_get_the_admins"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Get the admins</h3></div></div></div>

<p>In Cypher, we could get the admins like this:</p>
<pre class="programlisting" data-lang="cypher">MATCH ({ name: 'Admins' })&lt;-[:PART_OF*0..]-(group)&lt;-[:MEMBER_OF]-(user)
RETURN user.name, group.name</pre>
<p>resulting in:</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>user.name</th><th>group.name</th></tr></thead><tfoot><tr><th colspan="2">3 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"Demet"</code></p></td><td><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td><p><code class="literal">"Engin"</code></p></td><td><p><code class="literal">"HelpDesk"</code></p></td></tr><tr><td><p><code class="literal">"Ali"</code></p></td><td><p><code class="literal">"Admins"</code></p></td></tr></tbody></table></div>
<p>And here’s the code when using the Java Traversal API:</p>
<pre class="programlisting" data-lang="java">Node admins = getNodeByName( "Admins" );
TraversalDescription traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.PART_OF, Direction.INCOMING )
        .relationships( RoleRels.MEMBER_OF, Direction.INCOMING );
Traverser traverser = traversalDescription.traverse( admins );
</pre>
<p>resulting in the output</p>
<pre class="programlisting" data-lang="plain">Found: HelpDesk at depth: 0
Found: Ali at depth: 0
Found: Demet at depth: 1
Found: Engin at depth: 1</pre>
<p>The result is collected from the traverser using this code:</p>
<pre class="programlisting" data-lang="java">String output = "";
for ( Path path : traverser )
{
    Node node = path.endNode();
    output += "Found: " + node.getProperty( NAME ) + " at depth: "
              + ( path.length() - 1 ) + "\n";
}
</pre>
</section>
<section class="section" id="_get_the_group_memberships_of_a_user"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Get the group memberships of a user</h3></div></div></div>

<p>In Cypher:</p>
<pre class="programlisting" data-lang="cypher">MATCH ({ name: 'Jale' })-[:MEMBER_OF]-&gt;()-[:PART_OF*0..]-&gt;(group)
RETURN group.name</pre>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>group.name</th></tr></thead><tfoot><tr><th>3 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"ABCTechnicians"</code></p></td></tr><tr><td><p><code class="literal">"Technicians"</code></p></td></tr><tr><td><p><code class="literal">"Users"</code></p></td></tr></tbody></table></div>
<p>Using the Neo4j Java Traversal API, this query looks like:</p>
<pre class="programlisting" data-lang="java">Node jale = getNodeByName( "Jale" );
traversalDescription = db.traversalDescription()
        .depthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.MEMBER_OF, Direction.OUTGOING )
        .relationships( RoleRels.PART_OF, Direction.OUTGOING );
traverser = traversalDescription.traverse( jale );
</pre>
<p>resulting in:</p>
<pre class="programlisting" data-lang="plain">Found: ABCTechnicians at depth: 0
Found: Technicians at depth: 1
Found: Users at depth: 2</pre>
</section>
<section class="section" id="_get_all_groups"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Get all groups</h3></div></div></div>

<p>In Cypher:</p>
<pre class="programlisting" data-lang="cypher">MATCH ({ name: 'Reference_Node' })&lt;-[:ROOT]-&gt;()&lt;-[:PART_OF*0..]-(group)
RETURN group.name</pre>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>group.name</th></tr></thead><tfoot><tr><th>6 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"Users"</code></p></td></tr><tr><td><p><code class="literal">"Technicians"</code></p></td></tr><tr><td><p><code class="literal">"ABCTechnicians"</code></p></td></tr><tr><td><p><code class="literal">"Managers"</code></p></td></tr><tr><td><p><code class="literal">"Admins"</code></p></td></tr><tr><td><p><code class="literal">"HelpDesk"</code></p></td></tr></tbody></table></div>
<p>In Java:</p>
<pre class="programlisting" data-lang="java">Node referenceNode = getNodeByName( "Reference_Node") ;
traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator( Evaluators.excludeStartPosition() )
        .relationships( RoleRels.ROOT, Direction.INCOMING )
        .relationships( RoleRels.PART_OF, Direction.INCOMING );
traverser = traversalDescription.traverse( referenceNode );
</pre>
<p>resulting in:</p>
<pre class="programlisting" data-lang="plain">Found: Users at depth: 0
Found: Admins at depth: 0
Found: Technicians at depth: 1
Found: Managers at depth: 1
Found: HelpDesk at depth: 1
Found: ABCTechnicians at depth: 2</pre>
</section>
<section class="section" id="_get_all_members_of_all_groups"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Get all members of all groups</h3></div></div></div>

<p>Now, let’s try to find all users in the system being part of any group.</p>
<p>In Cypher, this looks like:</p>
<pre class="programlisting" data-lang="cypher">MATCH ({ name: 'Reference_Node' })&lt;-[:ROOT]-&gt;(root), p=(root)&lt;-[PART_OF*0..]-()&lt;-[:MEMBER_OF]-(user)
RETURN user.name, min(length(p))
ORDER BY min(length(p)), user.name</pre>
<p>and results in the following output:</p>
<div class="queryresult table"><table cellspacing="0" cellpadding="0"><thead><tr><th>user.name</th><th>min(length(p))</th></tr></thead><tfoot><tr><th colspan="2">10 rows</th></tr></tfoot><tbody><tr><td><p><code class="literal">"Ali"</code></p></td><td><p><code class="literal">1</code></p></td></tr><tr><td><p><code class="literal">"Burcu"</code></p></td><td><p><code class="literal">1</code></p></td></tr><tr><td><p><code class="literal">"Can"</code></p></td><td><p><code class="literal">1</code></p></td></tr><tr><td><p><code class="literal">"Engin"</code></p></td><td><p><code class="literal">1</code></p></td></tr><tr><td><p><code class="literal">"Demet"</code></p></td><td><p><code class="literal">2</code></p></td></tr><tr><td><p><code class="literal">"Fuat"</code></p></td><td><p><code class="literal">2</code></p></td></tr><tr><td><p><code class="literal">"Gul"</code></p></td><td><p><code class="literal">2</code></p></td></tr><tr><td><p><code class="literal">"Hakan"</code></p></td><td><p><code class="literal">2</code></p></td></tr><tr><td><p><code class="literal">"Irmak"</code></p></td><td><p><code class="literal">2</code></p></td></tr><tr><td><p><code class="literal">"Jale"</code></p></td><td><p><code class="literal">3</code></p></td></tr></tbody></table></div>
<p>in Java:</p>
<pre class="programlisting" data-lang="java">traversalDescription = db.traversalDescription()
        .breadthFirst()
        .evaluator(
                Evaluators.includeWhereLastRelationshipTypeIs( RoleRels.MEMBER_OF ) );
traverser = traversalDescription.traverse( referenceNode );
</pre>
<pre class="programlisting" data-lang="plain">Found: Can at depth: 1
Found: Burcu at depth: 1
Found: Engin at depth: 1
Found: Ali at depth: 1
Found: Irmak at depth: 2
Found: Hakan at depth: 2
Found: Fuat at depth: 2
Found: Gul at depth: 2
Found: Demet at depth: 2
Found: Jale at depth: 3</pre>
<p>As seen above, querying even more complex scenarios can be done using comparatively short
constructs in Cypher or Java.</p>
</section>
</section>

 <footer>
   <p>
   © Copyright
   <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img id="copyright-img" src="images/by-sa.svg" alt="CC BY-SA 3.0" title="Creative Commons Attribution-ShareAlike 3.0"></a>
   <a href="http://neo4j.com/"><img id="neotech-logo" src="images/neo-technology.svg" alt="Neo Technology"></a>
   </p>
 </footer>
  <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    //Allow Linker
    ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
    ga('send', 'pageview');

    // Load the plugin.
    ga('require', 'linker');

    // Define which domains to autoLink.
    ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
  </script>

</div></body></html>