<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>24.7. Memory mapped IO settings -  - The Neo4j Manual v2.3-SNAPSHOT</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="property-compression.html" title="24.6. Compressed storage of property values" /><link rel="next" href="configuration-settings.html" title="24.8. Configuration Settings Reference" /><link rel="copyright" href="ln-d5e39.html" title="License: Creative Commons 3.0" /><meta name="Section-title" content="24.7. Memory mapped IO settings" /><script type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-73202";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><meta name="viewport" content="width=device-width, initial-scale=1" /><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/themes/redmond/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><link rel="stylesheet" type="text/css" href="common/css/positioning.css" /><link rel="stylesheet" type="text/css" href="common/css/style.css" /><!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
  <![endif]--><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.4.0/css/font-awesome.min.css" rel="stylesheet" /><script type="text/javascript" src="common/browserDetect.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script><script type="text/javascript" src="common/jquery/jquery.highlight.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/2.1.1/jquery.scrollTo.min.js"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script><script type="text/javascript" src="common/main.js"></script><script type="text/javascript" src="search/l10n.js"></script><script type="text/javascript" src="search/htmlFileInfoList.js"></script><script type="text/javascript" src="common/search.js"></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"></script><script type="text/javascript" src="search/index-1.js"></script><script type="text/javascript" src="search/index-2.js"></script><script type="text/javascript" src="search/index-3.js"></script>


<!-- favicon -->

<link rel="shortcut icon" href="common/images/favicon.ico" />

<!-- fonts -->

<link href='//fonts.googleapis.com/css?family=Ubuntu+Mono|PT+Sans:400,700,400italic' rel='stylesheet' type='text/css' />

<!-- Syntax Highlighter -->

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/codemirror.min.css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/theme/neo.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/codemirror.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/addon/runmode/runmode.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/javascript/javascript.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/shell/shell.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/sql/sql.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/xml/xml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/clike/clike.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/cypher/cypher.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/5.6.0/mode/properties/properties.min.js"></script>

<script src="js/colorize.js"></script>
 
<script type="text/javascript">
  $(function (){
    CodeMirror.colorize();
  });
</script>

<!-- Section table of contents -->

<script type="text/javascript" src="js/toc.js"></script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/console.js"></script>
<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->
<script type="text/javascript" src="js/version.js"></script>
<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- Discuss -->
<script type="text/javascript" src="js/mutate.min.js"></script>
<script type="text/javascript" src="js/disqus.js"></script>

<script type="text/javascript">
    /*@cc_on @*/
    /*@
     $( '#content' ).addClass( 'internet-explorer' );
     @*/
</script>


</head><body><div id="header"><a href="index.html" id="logo"><img src="common/images/logo-neo4j.svg" alt="" /></a><h1><span id="book-title">The Neo4j Manual v2.3-SNAPSHOT</span><span>24.7. Memory mapped IO settings</span></h1><div id="navheader"><!----><div id="navLinks"><span><a id="showHideButton" href="#" class="pointLeft" tabindex="5" title="Show/Hide TOC tree"><i class="fa fa-columns"></i> Contents
            </a></span><span><a accesskey="p" id="navLinkPrevious" tabindex="5" href="property-compression.html"><i class="fa fa-arrow-circle-left"></i> Prev</a></span><span><a accesskey="u" id="navLinkUp" tabindex="5" href="configuration.html">Up <i class="fa fa-arrow-circle-up"></i></a></span><span><a accesskey="n" id="navLinkNext" tabindex="5" href="configuration-settings.html">Next <i class="fa fa-arrow-circle-right"></i></a></span></div></div></div><div id="content"><section class="section" id="configuration-io-examples"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">24.7. Memory mapped IO settings</h2></div></div></div><div class="toc"><ul class="toc"><li><span class="section"><a href="configuration-io-examples.html#_introduction_6">Introduction</a></span><ul><li><span class="section"><a href="configuration-io-examples.html#_configuration">Configuration</a></span></li></ul></li><li><span class="section"><a href="configuration-io-examples.html#configuration-batchinsert">Batch insert example</a></span></li></ul></div>

<section class="section" id="_introduction_6"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Introduction</h3></div></div></div>

<div class="sidebar"><div xmlns="" class="titlepage"><div><div><p xmlns="http://www.w3.org/1999/xhtml" class="title"><strong>Quick info</strong></p></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">

The page cache is sometimes called <span class="emphasis"><em>low level cache</em></span>, <span class="emphasis"><em>file system cache</em></span> or _file buffer cache _.

</li><li class="listitem">

It caches the Neo4j data as stored on the durable media.

</li><li class="listitem">

The default configuration of the cache relies on heuristics and assumes that the machine is dedicated to running Neo4j, so you might want to tune it yourself to get the most out of the available memory.

</li><li class="listitem">

There is just one setting for the file buffer cache: <code class="literal">dbms.pagecache.memory</code> - it specifies how much memory Neo4j is allowed to use for this cache.

</li></ul></div>
</div>
<p>Each file in the Neo4j store is accessed through the Neo4j page cache, when reading from, or writing to, the store files.
Since there is only one page cache, there is only one setting for specifying how much memory Neo4j is allowed to use for page caching.
The shared page cache ensures that memory is split across the various store files in the most optimal manner <a href="#ftn.d5e21982" class="footnote"><sup class="footnote" id="d5e21982">[1]</sup></a>, depending on how the database is used and what data is popular.</p>
<p>The memory for the page cache is allocated outside the normal Java heap, so you need to take both the Java heap, and the page cache, into consideration in your capacity planning.
Other processes running on the OS will impact the availability of such memory. Neo4j will require all of the heap memory of the JVM, plus the memory to be used for the page cache, to be available as physical memory.
Other processes may thus not use more than what is available after the configured memory allocation is made for Neo4j.</p>
<div class="admonitionblock Important"><table><tr><td class="icon"><img alt="[Important]" src="images/icons/admon/important.svg" /></td><td class="content"><b>Important</b><p>Make sure that your system is configured such that it will never need to swap.
If memory belonging to the Neo4j process gets swapped out, it can lead to considerable performance degradation.</p></td></tr></table></div>
<p>The amount of memory available to the page cache is configured using the <code class="literal">dbms.pagecache.memory</code> setting.
With that setting, you specify the number of bytes available to the page cache, e.g. <code class="literal">150m</code> og <code class="literal">4g</code>.
The default page memory setting is 75% of the machines memory, after subtracting the memory that is reserved for the Java heap.</p>
<p>For optimal performance, you will want to have as much of your data fit in the page cache as possible.
You can sum up the size of all the <code class="literal">*store.db*</code> files in your store file directory, to figure out how big a page cache you need to fit all your data.
For instance, on a posix system you can look at the total of running <code class="literal">$ du -hc *store.db*</code> in your <code class="literal">data/graph.db</code> directory.
Obviously the store files will grow as you add more nodes, relationships and properties, so configuring more page cache memory than you have data, is recommended when possible.</p>
<section class="section" id="_configuration"><div xmlns="" class="titlepage"><div><div><h4 xmlns="http://www.w3.org/1999/xhtml" class="title">Configuration</h4></div></div></div>

<div class="informaltable">
<table cellspacing="0" cellpadding="0"><thead><tr><th> Parameter                 </th><th> Possible values   </th><th> Effect</th></tr></thead><tbody><tr><td><p><code class="literal">dbms.pagecache.memory</code></p></td><td><p>The maximum amount of memory to use for the page cache, either in bytes, or greater byte-like units, such as <code class="literal">100m</code>
  for 100 mega-bytes, or <code class="literal">4g</code> for 4 giga-bytes.</p></td><td><p>The amount of memory to use for mapping the store files, in a unit of bytes.
  This will automatically be rounded down to the nearest whole page.
  This value cannot be zero.
  For extremely small and memory constrained deployments, it is recommended to still reserve at least a couple of megabytes for the page cache.</p></td></tr><tr><td><p><code class="literal">dump_configuration</code></p></td><td><p><code class="literal">true</code> or <code class="literal">false</code></p></td><td><p>If set to <code class="literal">true</code> the current configuration settings will be written to the default system output, mostly the console or the logfiles.</p></td></tr></tbody></table>
</div>
<p>When configuring the amount of memory allowed for the page cache and the JVM heap, make sure to also leave room for the operating systems page cache, and other programs and services the system might want to run.
It is important to configure the memory usage, such that the Neo4j JVM process won’t need to use any swap memory, as this will cause a significant drag on the performance of the system.</p>
<p>When reading the configuration parameters on startup Neo4j will automatically configure the parameters that are not specified.
The cache size will be configured based on the available memory on the computer, with the assumption that the machine is dedicated to running Neo4j.
Specifically, Neo4j will look at how much memory the machine has, subtract the JVM heap allocation from that, and then use 75% of what is left for the page cache.
This is the default configuration when nothing else is specified.</p>
</section>
</section>
<section class="section" id="configuration-batchinsert"><div xmlns="" class="titlepage"><div><div><h3 xmlns="http://www.w3.org/1999/xhtml" class="title">Batch insert example</h3></div></div></div>

<p>Read general information on batch insertion in <a class="xref" href="batchinsert.html" title="Chapter 36. Batch Insertion">Chapter 36, <em>Batch Insertion</em></a>.</p>
<p>The configuration should suit the data set you are about to inject using BatchInsert.
Lets say we have a random-like graph with 10M nodes and 100M relationships.
Each node (and maybe some relationships) have different properties of string and Java primitive types.
The important thing is that the page cache has enough memory to work with, that it doesn’t slow down the BatchInserter:</p>
<pre class="programlisting" data-lang="plain">dbms.pagecache.memory=4g</pre>
<p>The configuration above will more or less fit the entire graph in memory.
A rough formula to calculate the memory needed can look like this:</p>
<pre class="programlisting" data-lang="plain">bytes_needed = number_of_nodes * 15
             + number_of_relationships * 34
             + number_of_properties * 64</pre>
<p>Note that the size of the individual property very much depends on what data it contains. The numbers given in the above formula are only a rough estimate.</p>
</section>
<div class="footnotes"><br /><hr style="width:100; text-align:left;margin-left: 0" /><div id="ftn.d5e21982" class="footnote"><p><a href="#d5e21982" class="simpara"><sup class="simpara">[1] </sup></a>This is an informal comparison to the store-specific memory mapping settings of previous versions of Neo4j. We are not claiming that our page replacement algorithms are optimal in the formal sense. Truly optimal page replacement algorithms require knowledge of events arbitrarily far into the future.</p></div></div></section>

 <footer>
   <p>
   © Copyright
   <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img id="copyright-img" src="images/by-sa.svg" alt="CC BY-SA 3.0" title="Creative Commons Attribution-ShareAlike 3.0"></a>
   <a href="http://neo4j.com/"><img id="neotech-logo" src="images/neo-technology.svg" alt="Neo Technology"></a>
   </p>
 </footer>
  <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    //Allow Linker
    ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
    ga('send', 'pageview');

    // Load the plugin.
    ga('require', 'linker');

    // Define which domains to autoLink.
    ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
  </script>

</div></body></html>