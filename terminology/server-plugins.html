<!DOCTYPE html><html xmlns="http://www.w3.org/1999/xhtml"><head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>34.1. Server Plugins -  - The Neo4j Manual v2.2-SNAPSHOT</title><meta name="generator" content="DocBook XSL Stylesheets V1.78.1" /><link rel="prev" href="server-extending.html" title="Chapter 34. Extending the Neo4j Server" /><link rel="next" href="server-unmanaged-extensions.html" title="34.2. Unmanaged Extensions" /><link rel="copyright" href="ln-d5e39.html" title="License: Creative Commons 3.0" /><meta name="Section-title" content="34.1. Server Plugins" /><script type="text/javascript">
      //The id for tree cookie
      var treeCookieId = "treeview-72623";
      var language = "en";
      var w = new Object();
      //Localization
      txt_filesfound = 'Results';
      txt_enter_at_least_1_char = "You must enter at least one character.";
      txt_browser_not_supported = "JavaScript is disabled on your browser. Please enable JavaScript to enjoy all the features of this site.";
      txt_please_wait = "Please wait. Search in progress...";
      txt_results_for = "Results for: ";
    </script><meta name="viewport" content="width=device-width, initial-scale=1" /><link href="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css" rel="stylesheet" /><link rel="stylesheet" type="text/css" href="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/themes/redmond/jquery-ui.min.css" /><link rel="stylesheet" type="text/css" href="common/jquery/treeview/jquery.treeview.css" /><link rel="stylesheet" type="text/css" href="common/css/positioning.css" /><link rel="stylesheet" type="text/css" href="common/css/style.css" /><!--[if IE]>
  <link rel="stylesheet" type="text/css" href="../common/css/ie.css"/>
  <![endif]--><link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet" /><script type="text/javascript" src="common/browserDetect.js"></script><script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="//ajax.googleapis.com/ajax/libs/jqueryui/1.11.1/jquery-ui.min.js"></script><script type="text/javascript" src="common/jquery/jquery.highlight.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script><script type="text/javascript" src="common/jquery/treeview/jquery.treeview.min.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery-scrollTo/1.4.11/jquery.scrollTo.min.js"></script><script src="//maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script><script type="text/javascript" src="common/main.js"></script><script type="text/javascript" src="search/l10n.js"></script><script type="text/javascript" src="search/htmlFileInfoList.js"></script><script type="text/javascript" src="common/search.js"></script><script type="text/javascript" src="search/stemmers/en_stemmer.js"></script><script type="text/javascript" src="search/index-1.js"></script><script type="text/javascript" src="search/index-2.js"></script><script type="text/javascript" src="search/index-3.js"></script>


<!-- favicon -->

<link rel="shortcut icon" href="common/images/favicon.ico" />

<!-- fonts -->

<link href='//fonts.googleapis.com/css?family=Ubuntu+Mono|PT+Sans:400,700,400italic' rel='stylesheet' type='text/css' />

<!-- Syntax Highlighter -->

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/codemirror.min.css" />
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/theme/neo.min.css" />
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/codemirror.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/addon/runmode/runmode.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/javascript/javascript.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/shell/shell.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/sql/sql.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/xml/xml.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/clike/clike.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/cypher/cypher.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/codemirror/4.6.0/mode/properties/properties.min.js"></script>

<script src="js/colorize.js"></script>
 
<script type="text/javascript">
  $(function (){
    CodeMirror.colorize();
  });
</script>

<!-- Cypher Console -->

<script type="text/javascript" src="js/console.js"></script>
<script type="text/javascript" src="js/cypherconsole.js"></script>

<!-- Version -->
<script type="text/javascript" src="js/version.js"></script>
<script type="text/javascript" src="js/versionswitcher.js"></script>

<!-- Discuss -->
<script type="text/javascript" src="js/mutate.min.js"></script>
<script type="text/javascript" src="js/disqus.js"></script>

<script type="text/javascript">
    /*@cc_on @*/
    /*@
     $( '#content' ).addClass( 'internet-explorer' );
     @*/
</script>


</head><body><div id="header"><a href="index.html" id="logo"><img src="common/images/logo-neo4j.svg" alt="" /></a><h1><span id="book-title">The Neo4j Manual v2.2-SNAPSHOT</span><span>34.1. Server Plugins</span></h1><div id="navheader"><!----><div id="navLinks"><span><a id="showHideButton" href="#" class="pointLeft" tabindex="5" title="Show/Hide TOC tree"><i class="fa fa-columns"></i> Contents
            </a></span><span><a accesskey="p" id="navLinkPrevious" tabindex="5" href="server-extending.html"><i class="fa fa-arrow-circle-left"></i> Prev</a></span><span><a accesskey="u" id="navLinkUp" tabindex="5" href="server-extending.html">Up <i class="fa fa-arrow-circle-up"></i></a></span><span><a accesskey="n" id="navLinkNext" tabindex="5" href="server-unmanaged-extensions.html">Next <i class="fa fa-arrow-circle-right"></i></a></span></div></div></div><div id="content"><section class="section" id="server-plugins"><div xmlns="" class="titlepage"><div><div><h2 xmlns="http://www.w3.org/1999/xhtml" class="title" style="clear: both">34.1. Server Plugins</h2></div></div></div>

<div class="sidebar"><div xmlns="" class="titlepage"><div><div><p xmlns="http://www.w3.org/1999/xhtml" class="title"><strong>Quick info</strong></p></div></div></div>

<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">

The server’s functionality can be extended by adding plugins.

</li><li class="listitem">

Plugins are user-specified code which extend the capabilities of the database, nodes, or relationships.

</li><li class="listitem">

The neo4j server will then advertise the plugin functionality within representations as clients interact via HTTP.

</li></ul></div>
</div>
<p>Plugins provide an easy way to extend the Neo4j REST API with new functionality, without the need to
invent your own API.
Think of plugins as server-side scripts that can add functions for retrieving and manipulating nodes, relationships, paths, properties or indices.</p>
<div class="admonitionblock Tip"><table><tr><td class="icon"><img alt="[Tip]" src="images/icons/admon/tip.svg" /></td><td class="content"><b>Tip</b><p>If you want to have full control over your API, and are willing to put in the effort, and understand the risks, then Neo4j server also provides hooks for <a class="link" href="server-unmanaged-extensions.html" title="34.2. Unmanaged Extensions">unmanaged extensions</a> based on JAX-RS.</p></td></tr></table></div>
<p>The needed classes reside in the <a class="ulink" href="http://search.maven.org/#search|gav|1|g%3A%22org.neo4j%22%20AND%20a%3A%22server-api%22" target="_blank">org.neo4j:server-api</a> jar file.
See the linked page for downloads and instructions on how to include it using dependency management.
For Maven projects, add the Server API dependencies in your <code class="literal">pom.xml</code> like this:</p>
<pre class="programlisting" data-lang="xml">&lt;dependency&gt;
  &lt;groupId&gt;org.neo4j&lt;/groupId&gt;
  &lt;artifactId&gt;server-api&lt;/artifactId&gt;
  &lt;version&gt;${neo4j-version}&lt;/version&gt;
&lt;/dependency&gt;</pre>
<p><span class="emphasis"><em>Where ${neo4j-version} is the intended version.</em></span></p>
<p>To create a plugin, your code must inherit from the <a class="ulink" href="javadocs/org/neo4j/server/plugins/ServerPlugin.html" target="_blank">ServerPlugin</a> class.
Your plugin should also:</p>
<div class="itemizedlist"><ul class="itemizedlist" style="list-style-type: disc; "><li class="listitem">

ensure that it can produce an (Iterable of) <code class="literal">Node</code>, <code class="literal">Relationship</code> or <code class="literal">Path</code>, any Java primitive or <code class="literal">String</code> or an instance of a <code class="literal">org.neo4j.server.rest.repr.Representation</code>

</li><li class="listitem">

specify parameters,

</li><li class="listitem">

specify a point of extension and of course

</li><li class="listitem">

contain the application logic.

</li><li class="listitem">

make sure that the discovery point type in the <code class="literal">@PluginTarget</code> and the <code class="literal">@Source</code> parameter are of the same type.

</li></ul></div>
<p>An example of a plugin which augments the database (as opposed to nodes or relationships) follows:</p>
<p><strong>Get all nodes or relationships plugin </strong>
</p><pre class="programlisting" data-lang="java">@Description( "An extension to the Neo4j Server for getting all nodes or relationships" )
public class GetAll extends ServerPlugin
{
    @Name( "get_all_nodes" )
    @Description( "Get all nodes from the Neo4j graph database" )
    @PluginTarget( GraphDatabaseService.class )
    public Iterable&lt;Node&gt; getAllNodes( @Source GraphDatabaseService graphDb )
    {
        ArrayList&lt;Node&gt; nodes = new ArrayList&lt;&gt;();
        try (Transaction tx = graphDb.beginTx())
        {
            for ( Node node : GlobalGraphOperations.at( graphDb ).getAllNodes() )
            {
                nodes.add( node );
            }
            tx.success();
        }
        return nodes;
    }

    @Description( "Get all relationships from the Neo4j graph database" )
    @PluginTarget( GraphDatabaseService.class )
    public Iterable&lt;Relationship&gt; getAllRelationships( @Source GraphDatabaseService graphDb )
    {
        List&lt;Relationship&gt; rels = new ArrayList&lt;&gt;();
        try (Transaction tx = graphDb.beginTx())
        {
            for ( Relationship rel : GlobalGraphOperations.at( graphDb ).getAllRelationships() )
            {
                rels.add( rel );
            }
            tx.success();
        }
        return rels;
    }
}
</pre><p>
</p>
<p>The full source code is found here:
<a class="ulink" href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/plugins/GetAll.java" target="_blank">GetAll.java</a></p>
<p><strong>Find the shortest path between two nodes plugin </strong>
</p><pre class="programlisting" data-lang="java">public class ShortestPath extends ServerPlugin
{
    @Description( "Find the shortest path between two nodes." )
    @PluginTarget( Node.class )
    public Iterable&lt;Path&gt; shortestPath(
            @Source Node source,
            @Description( "The node to find the shortest path to." )
                @Parameter( name = "target" ) Node target,
            @Description( "The relationship types to follow when searching for the shortest path(s). " +
                    "Order is insignificant, if omitted all types are followed." )
                @Parameter( name = "types", optional = true ) String[] types,
            @Description( "The maximum path length to search for, default value (if omitted) is 4." )
                @Parameter( name = "depth", optional = true ) Integer depth )
    {
        PathExpander&lt;?&gt; expander;
        List&lt;Path&gt; paths = new ArrayList&lt;&gt;();
        if ( types == null )
        {
            expander = PathExpanders.allTypesAndDirections();
        }
        else
        {
            PathExpanderBuilder expanderBuilder = PathExpanderBuilder.empty();
            for ( int i = 0; i &lt; types.length; i++ )
            {
                expanderBuilder = expanderBuilder.add( DynamicRelationshipType.withName( types[i] ) );
            }
            expander = expanderBuilder.build();
        }
        try (Transaction tx = source.getGraphDatabase().beginTx())
        {
            PathFinder&lt;Path&gt; shortestPath = GraphAlgoFactory.shortestPath( expander,
                    depth == null ? 4 : depth.intValue() );
            for ( Path path : shortestPath.findAllPaths( source, target ) )
            {
                paths.add( path );
            }
            tx.success();
        }
        return paths;
    }
}
</pre><p>
</p>
<p>The full source code is found here:
<a class="ulink" href="https://github.com/neo4j/neo4j/blob/master/community/server-examples/src/main/java/org/neo4j/examples/server/plugins/ShortestPath.java" target="_blank">ShortestPath.java</a></p>
<p>To deploy the code, simply compile it into a .jar file and place it onto the server classpath (which by
convention is the plugins directory under the Neo4j server home directory).</p>
<div class="admonitionblock Tip"><table><tr><td class="icon"><img alt="[Tip]" src="images/icons/admon/tip.svg" /></td><td class="content"><b>Tip</b><p>Make sure the directories listings are retained in the jarfile by either building with default Maven, or with <code class="literal">jar -cvf myext.jar *</code>, making sure
to jar directories instead of specifying single files.</p></td></tr></table></div>
<p>The <span class="emphasis"><em>.jar</em></span> file must include the file <span class="emphasis"><em>META-INF/services/org.neo4j.server.plugins.ServerPlugin</em></span> with the fully qualified name of the implementation class.
This is an example with multiple entries, each on a separate line:</p>
<pre class="programlisting" data-lang="plain">org.neo4j.examples.server.plugins.DepthTwo
org.neo4j.examples.server.plugins.GetAll
org.neo4j.examples.server.plugins.ShortestPath</pre>
<p>The code above makes an extension visible in the database representation (via the <code class="literal">@PluginTarget</code> annotation)
whenever it is served from the Neo4j Server.
Simply changing the <code class="literal">@PluginTarget</code> parameter to <code class="literal">Node.class</code> or <code class="literal">Relationship.class</code> allows us to target those parts of the data model should we wish.
The functionality extensions provided by the plugin are automatically advertised in representations on the wire.
For example, clients can discover the extension implemented by the above plugin easily by examining the representations
they receive as responses from the server, e.g. by performing a <code class="literal">GET</code> on the default database URI:</p>
<pre class="programlisting" data-lang="shell">curl -v http://localhost:7474/db/data/</pre>
<p>The response to the <code class="literal">GET</code> request will contain (by default) a JSON container that itself contains a container
called "extensions" where the available plugins are listed.
In the following case, we only have the <code class="literal">GetAll</code> plugin registered with the server, so only its extension functionality is available.
Extension names will be automatically assigned, based on method names, if not specifically specified using the <code class="literal">@Name</code> annotation.</p>
<pre class="programlisting" data-lang="javascript">{
"extensions-info" : "http://localhost:7474/db/data/ext",
"node" : "http://localhost:7474/db/data/node",
"node_index" : "http://localhost:7474/db/data/index/node",
"relationship_index" : "http://localhost:7474/db/data/index/relationship",
"reference_node" : "http://localhost:7474/db/data/node/0",
"extensions_info" : "http://localhost:7474/db/data/ext",
"extensions" : {
  "GetAll" : {
    "get_all_nodes" : "http://localhost:7474/db/data/ext/GetAll/graphdb/get_all_nodes",
    "get_all_relationships" : "http://localhost:7474/db/data/ext/GetAll/graphdb/getAllRelationships"
  }
}</pre>
<p>Performing a <code class="literal">GET</code> on one of the two extension URIs gives back the meta information about the service:</p>
<pre class="programlisting" data-lang="shell">curl http://localhost:7474/db/data/ext/GetAll/graphdb/get_all_nodes</pre>
<pre class="programlisting" data-lang="javascript">{
  "extends" : "graphdb",
  "description" : "Get all nodes from the Neo4j graph database",
  "name" : "get_all_nodes",
  "parameters" : [ ]
}</pre>
<p>To use it, just <code class="literal">POST</code> to this URL, with parameters as specified in the description and encoded as JSON data content.
For example for calling the <code class="literal">shortest path</code> extension (URI gotten from a <code class="literal">GET</code> to <a class="ulink" href="http://localhost:7474/db/data/node/123" target="_blank">http://localhost:7474/db/data/node/123</a>):</p>
<pre class="programlisting" data-lang="bash">curl -X POST http://localhost:7474/db/data/ext/ShortestPath/node/123/shortestPath \
  -H "Content-Type: application/json" \
  -d '{"target":"http://localhost:7474/db/data/node/456", "depth":"5"}'</pre>
<p>If everything is OK a response code <code class="literal">200</code> and a list of zero or more items will be returned.
If nothing is returned (null returned from extension) an empty result and response code <code class="literal">204</code> will be returned.
If the extension throws an exception response code <code class="literal">500</code> and a detailed error message is returned.</p>
<p>Extensions that do any kind of database operation will have to manage their own transactions, i.e. transactions aren’t managed automatically.
Note that the results of traversals or execution of graph algorithms should be exhausted inside the transaction before returning the result.</p>
<p>Through this model, any plugin can naturally fit into the general hypermedia scheme that Neo4j espouses — meaning that
clients can still take advantage of abstractions like  Nodes, Relationships and Paths with a straightforward upgrade
path as servers are enriched with plugins (old clients don’t break).</p>
</section>

 <footer>
   <p>
   © Copyright
   <a href="http://creativecommons.org/licenses/by-sa/3.0/"><img id="copyright-img" src="images/by-sa.svg" alt="CC BY-SA 3.0" title="Creative Commons Attribution-ShareAlike 3.0"></a>
   <a href="http://neo4j.com/"><img id="neotech-logo" src="images/neo-technology.svg" alt="Neo Technology"></a>
   </p>
 </footer>
  <script type="text/javascript">

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    //Allow Linker
    ga('create', 'UA-1192232-34','auto', {'allowLinker': true});
    ga('send', 'pageview');

    // Load the plugin.
    ga('require', 'linker');

    // Define which domains to autoLink.
    ga('linker:autoLink', ['neo4j.org','neo4j.com','neotechnology.com','graphdatabases.com','graphconnect.com']);
  </script>

</div></body></html>